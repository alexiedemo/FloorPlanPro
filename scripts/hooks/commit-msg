#!/bin/bash

set -euo pipefail

COMMIT_MSG_FILE="$1"
COMMIT_MSG=$(sed '1q' "$COMMIT_MSG_FILE")

if git rev-parse -q --verify MERGE_HEAD >/dev/null 2>&1; then
  exit 0
fi

if [[ "$COMMIT_MSG" =~ ^revert: ]]; then
  exit 0
fi

PATTERN='^(feat|fix|docs|style|refactor|perf|test|build|ci|chore)(\([A-Za-z0-9_-]+\))?: .+'

if [[ "$COMMIT_MSG" =~ $PATTERN ]]; then
  exit 0
fi

echo "\nConventional Commit required (type(scope?): description)." >&2
echo "Allowed types: feat, fix, docs, style, refactor, perf, test, build, ci, chore." >&2
exit 1
